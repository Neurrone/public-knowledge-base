<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><title>Using Serverless Framework With Aws</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal knowledge Base"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="neurrone"/><meta name="twitter:creator" content="neurrone"/><meta property="og:title" content="Using Serverless Framework With Aws"/><meta property="og:description" content="Personal knowledge Base"/><meta property="og:url" content="https://kb.neurrone.com/notes/563ce103-bde6-4e92-b41a-184940dace74/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="4/3/2021"/><meta property="article:modified_time" content="12/4/2021"/><link rel="canonical" href="https://kb.neurrone.com/notes/563ce103-bde6-4e92-b41a-184940dace74/"/><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/d1ad9e75dd743084.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d1ad9e75dd743084.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-5502dedc02bf7a1e.js" defer=""></script><script src="/_next/static/chunks/framework-bb5c596eafb42b22.js" defer=""></script><script src="/_next/static/chunks/main-c4b0e551a2150d17.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f94d8258faf25bb5.js" defer=""></script><script src="/_next/static/chunks/155-3a6c02d7e042edb7.js" defer=""></script><script src="/_next/static/chunks/pages/notes/%5Bid%5D-dc9b1cbe134a7143.js" defer=""></script><script src="/_next/static/tdwb319N3I1tdYSIuISDD/_buildManifest.js" defer=""></script><script src="/_next/static/tdwb319N3I1tdYSIuISDD/_ssgManifest.js" defer=""></script><script src="/_next/static/tdwb319N3I1tdYSIuISDD/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout site-layout" style="margin-top:64px"><section class="ant-layout site-layout" style="flex-direction:row"><section class="ant-layout site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></section><section class="ant-layout side-layout-main" style="max-width:1200px;display:initial"><main class="ant-layout-content main-content" role="main" style="padding:0 24px"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h2 id="api-gateway"><a aria-hidden="true" class="anchor-heading" href="#api-gateway"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Api-gateway</h2>
<p>As at time of writing (Apr 2021), configuring api-gateway with api keys and usage plans is bugged according to the official docs. The docs say to <a href="https://www.serverless.com/framework/docs/deprecations#api-gateway-specific-configuration">put configuration in provider.apigateway, instead of under provider directly</a>.</p>
<p>However, this does not work, and you must place them under provider (the deprecated behaviour) instead.</p>
<h2 id="errors-during-sls-deploy"><a aria-hidden="true" class="anchor-heading" href="#errors-during-sls-deploy"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Errors During sls deploy</h2>
<p>Sometimes, deploying the cloud formation stack fails with errors such as "stack not found".</p>
<p>The error messages are horrible; errors in the serverless.yml file could cause it. This is probably caused by the error causing the stack creation to fail, resulting in subsequent commands not being able to use it.</p>
<h2 id="check-lambda-permissions"><a aria-hidden="true" class="anchor-heading" href="#check-lambda-permissions"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Check Lambda Permissions</h2>
<pre class="language-sh"><code class="language-sh">aws iam get-role-policy --role-name &#x3C;function role> --policy-name &#x3C;policy name>

# to get the function role
aws lambda get-function --function-name &#x3C;function>

# to get policy name
aws iam list-role-policies --role-name &#x3C;role>
</code></pre>
<hr>
<strong>Children</strong>
<ol>
<li><a href="/notes/78z64Y87ceXyHC6NGVM84">Sqs With Aws Lambda</a></li>
</ol></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#api-gateway" title="Api-gateway">Api-gateway</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#errors-during-sls-deploy" title="Errors During sls deploy">Errors During sls deploy</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#check-lambda-permissions" title="Check Lambda Permissions">Check Lambda Permissions</a></div></div></div></div></div></div></div></div></div></main><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></section></section></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"563ce103-bde6-4e92-b41a-184940dace74","title":"Using Serverless Framework With Aws","desc":"Gotchas when using the serverless framework with AWS","updated":1638612147568,"created":1617456663738,"custom":{},"fname":"tools.serverless.aws","type":"note","vault":{"name":"main","fsPath":"main","useFMTitle":false},"contentHash":"d730498686e09f921574bbd42fb4923a","links":[],"anchors":{"api-gateway":{"type":"header","text":"Api-gateway","value":"api-gateway","line":8,"column":0,"depth":2},"errors-during-sls-deploy":{"type":"header","text":"Errors During sls deploy","value":"errors-during-sls-deploy","line":14,"column":0,"depth":2},"check-lambda-permissions":{"type":"header","text":"Check Lambda Permissions","value":"check-lambda-permissions","line":20,"column":0,"depth":2}},"children":["78z64Y87ceXyHC6NGVM84"],"parent":"93e0f902-47d4-4cc7-9027-5de0012f6c57","data":{}},"body":"\u003ch2 id=\"api-gateway\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#api-gateway\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eApi-gateway\u003c/h2\u003e\n\u003cp\u003eAs at time of writing (Apr 2021), configuring api-gateway with api keys and usage plans is bugged according to the official docs. The docs say to \u003ca href=\"https://www.serverless.com/framework/docs/deprecations#api-gateway-specific-configuration\"\u003eput configuration in provider.apigateway, instead of under provider directly\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eHowever, this does not work, and you must place them under provider (the deprecated behaviour) instead.\u003c/p\u003e\n\u003ch2 id=\"errors-during-sls-deploy\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#errors-during-sls-deploy\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eErrors During sls deploy\u003c/h2\u003e\n\u003cp\u003eSometimes, deploying the cloud formation stack fails with errors such as \"stack not found\".\u003c/p\u003e\n\u003cp\u003eThe error messages are horrible; errors in the serverless.yml file could cause it. This is probably caused by the error causing the stack creation to fail, resulting in subsequent commands not being able to use it.\u003c/p\u003e\n\u003ch2 id=\"check-lambda-permissions\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#check-lambda-permissions\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eCheck Lambda Permissions\u003c/h2\u003e\n\u003cpre class=\"language-sh\"\u003e\u003ccode class=\"language-sh\"\u003eaws iam get-role-policy --role-name \u0026#x3C;function role\u003e --policy-name \u0026#x3C;policy name\u003e\n\n# to get the function role\naws lambda get-function --function-name \u0026#x3C;function\u003e\n\n# to get policy name\naws iam list-role-policies --role-name \u0026#x3C;role\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003cstrong\u003eChildren\u003c/strong\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"/notes/78z64Y87ceXyHC6NGVM84\"\u003eSqs With Aws Lambda\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e","noteIndex":{"id":"root","title":"root","desc":"","updated":1622102326440,"created":1595961348801,"stub":false,"custom":{"stub":false,"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"name":"main","fsPath":"main","useFMTitle":false},"contentHash":"2222728f026e86e75d06a6048c4f43ed","links":[],"anchors":{"personal-knowledge-base":{"type":"header","text":"Personal Knowledge Base","value":"personal-knowledge-base","line":9,"column":0,"depth":1}},"children":["9fa47ef8-a44b-4e36-929f-4aa7835b474d","6e43ea37-b3e7-44cf-aac7-31ae947d32a2","a10a1802-11d0-4557-a374-89712109cf90","0b9beaed-19ee-4124-a880-07e520da2b17","ddf3e9b2-ea12-4129-8785-06d6b82d4fcb","f2lgs4q62lecgskzjujmzfe","b4be93a8-69e3-4427-b4cd-53593c3ab387","5bbec2d1-4abe-4a2a-8bc5-5f3d4e229766","4a064a97-3d2d-4429-9a08-5b158dc7ef35","543e830d-feac-4048-8075-58c406bc1105","8875d2cf-85f8-41e8-b16d-c3707e40d74e","8ec37b11-59ad-4ea8-82d9-3186e7e0cd29","dOehc8Yap1zIbEqLvQvOt","b58269ed-9a0e-4213-b5b0-6d59c81d9899","b4fc6d48-17ae-4764-acdb-ec0f52707860","091b67bf-8bfa-454c-bbd3-7d84d8216229","f6fbee87-be27-471c-99bd-4af45d6a3156","fb9e4130-eaf8-425d-9039-5bc2ee876f18","4fb536a9-c146-4df3-8f30-9b2fb52a77f7","8960pv5qwdxgvxf5huf0zvc","hkjct502fmngc298ymusxv2","21ef758d-ca84-4be0-8eed-5e95ab3b4a7e","5fb5baa9-8b3d-4044-9c03-bbabfbdfe78a","2f6af89e-df82-4144-87fc-a2be66a0e657","POgyWcSIqi29tpqfP5uyS","pbvz7g6koyvpxwoh799qjwn","hebvr7iuk5olzjda0gt0k8f","6foliioh1t94bdetoquq8zl"],"parent":null,"data":{},"body":"\n# Personal Knowledge Base\n\nHi, and welcome to [Dickson Tan's](https://neurrone.com/pages/about/) personal knowledge base.\n\nThis is an experiment in note taking with the Zettelkasten method. This site is rendered with [Dendron](https://wiki.dendron.so/) which generates backlinks and an index, and provides other convenience features.\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"previewV2Enabled":false,"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":false,"leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2,"vaultSelectionModeOnCreate":"smart"}},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"randomNote":{},"copyNoteLink":{}},"workspace":{"dendronVersion":"0.85.0","vaults":[{"fsPath":"human-dynamics","name":"Human Dynamics","useFMTitle":false},{"name":"govtech","fsPath":"govtech","visibility":"private","useFMTitle":false},{"name":"health","fsPath":"health","useFMTitle":false},{"name":"main","fsPath":"main","useFMTitle":false},{"name":"personal","fsPath":"personal","visibility":"private"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"graph":{"zoomSpeed":1},"disableTelemetry":true,"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"maxPreviewsCached":10,"maxNoteLength":204800,"enableUserTags":true,"enableHashTags":true,"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link"},"enableEditorDecorations":true},"preview":{"enableFMTitle":false,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"automaticallyShowPreview":false},"publishing":{"enableFMTitle":false,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"enableSiteLastModified":true,"siteRootDir":"docs","siteUrl":"https://kb.neurrone.com","enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"duplicateNoteBehavior":{"action":"useVault","payload":["main","health","Human Dynamics"]},"writeStubs":false,"seo":{"title":"Personal Knowledge Base","description":"Personal knowledge Base","author":"Dickson Tan","twitter":"neurrone"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enablePrettyLinks":true,"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"563ce103-bde6-4e92-b41a-184940dace74"},"buildId":"tdwb319N3I1tdYSIuISDD","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>