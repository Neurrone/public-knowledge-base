<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><title>PostgreSQL</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal knowledge Base"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="neurrone"/><meta name="twitter:creator" content="neurrone"/><meta property="og:title" content="PostgreSQL"/><meta property="og:description" content="Personal knowledge Base"/><meta property="og:url" content="https://kb.neurrone.com/notes/57d0b6de-d1a2-4e2c-8548-83f54c96b0f3/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="4/11/2021"/><meta property="article:modified_time" content="12/23/2021"/><link rel="canonical" href="https://kb.neurrone.com/notes/57d0b6de-d1a2-4e2c-8548-83f54c96b0f3/"/><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/c8bd6a2ea62588ea.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c8bd6a2ea62588ea.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-d2cef17dcd7cee1f.js" defer=""></script><script src="/_next/static/chunks/framework-dc33c0b5493501f0.js" defer=""></script><script src="/_next/static/chunks/main-7471899870417a74.js" defer=""></script><script src="/_next/static/chunks/pages/_app-e05338a96d764da3.js" defer=""></script><script src="/_next/static/chunks/155-0a8d44b6408c244d.js" defer=""></script><script src="/_next/static/chunks/pages/notes/%5Bid%5D-30a63e62504f2dc5.js" defer=""></script><script src="/_next/static/17b8tlY5vwWfS-FGW7Cgx/_buildManifest.js" defer=""></script><script src="/_next/static/17b8tlY5vwWfS-FGW7Cgx/_ssgManifest.js" defer=""></script><script src="/_next/static/17b8tlY5vwWfS-FGW7Cgx/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div class="ant-col ant-col-xs-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"></div><div class="ant-col ant-col-xs-12"></div><div style="margin-left:4px;display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout site-layout" style="margin-top:64px"><section class="ant-layout site-layout" style="flex-direction:row"><section class="ant-layout site-layout-sidebar" style="flex:0 0 auto;width:calc((100% - 992px) / 2 + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></section><section class="ant-layout side-layout-main" style="max-width:1200px;display:initial"><main class="ant-layout-content main-content" role="main" style="padding:0 24px"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="postgres"><a aria-hidden="true" class="anchor-heading" href="#postgres"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Postgres</h1>
<h2 id="configuration"><a aria-hidden="true" class="anchor-heading" href="#configuration"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Configuration</h2>
<ul>
<li><a href="https://postgresqlco.nf/">Postgresco.nf</a> has recommendations for how to tune and configure various Postgres parameters, and documentation in a convenient readable format</li>
<li><a href="https://pgtune.leopard.in.ua/">PGTune</a> generates configs for various scenarios that can be used as a starting point</li>
</ul>
<h2 id="connection-pooling"><a aria-hidden="true" class="anchor-heading" href="#connection-pooling"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Connection Pooling</h2>
<ul>
<li><a href="https://www.pgbouncer.org/">PgBouncer</a></li>
<li><a href="https://www.pgpool.net/mediawiki/index.php/Main_Page">Pgpool</a>, apparently more versatile than PgBouncer</li>
</ul>
<h2 id="gotchas"><a aria-hidden="true" class="anchor-heading" href="#gotchas"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Gotchas</h2>
<ul>
<li><a href="https://pgdash.io/blog/postgresql-six-not-so-easy-pieces.html">PostgreSQL: Six Not-So-Easy Pieces</a></li>
<li><a href="https://rbranson.medium.com/10-things-i-hate-about-postgresql-20dbab8c2791">10 Things I Hate About PostgreSQL</a></li>
<li><a href="https://blog.timescale.com/blog/how-we-made-distinct-queries-up-to-8000x-faster-on-postgresql/">How we made DISTINCT queries up to 8000x faster on PostgreSQL </a>
<blockquote>
<p>PostgreSQL currently lacks the ability to efficiently pull a list of unique values from an ordered index. Even when you have an index that matches the exact order and columns for these "last point" queries, PostgreSQL is still forced to scan the entire index to find all unique values. As a table grows (and they grow quickly with time-series data), this operation keeps getting slower.</p>
</blockquote>
</li>
<li><a href="https://news.ycombinator.com/item?id=28489340">HN comment on the planner randomly switching to using a bad plan, slowing down queries significantly</a></li>
<li><a href="https://about.gitlab.com/blog/2021/09/29/why-we-spent-the-last-month-eliminating-postgresql-subtransactions/">Problems with subtransactions</a></li>
</ul>
<h2 id="security"><a aria-hidden="true" class="anchor-heading" href="#security"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Security</h2>
<ul>
<li><a href="https://goteleport.com/blog/securing-postgres-postgresql/">PostgreSQL Security Hardening</a></li>
</ul>
<h2 id="text-vs-varchar"><a aria-hidden="true" class="anchor-heading" href="#text-vs-varchar"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Text Vs Varchar</h2>
<p>The <code>text</code> data type has no limits on string length and seems like an easy choice over using <code>varchar</code>, as there are no performance advantages to using <code>varchar</code> over <code>text</code>. However, using <code>varchar</code> can help <a href="https://brandur.org/text">enforce constraints on reasonable text lengths</a> and prevents storage of too much data.</p>
<h2 id="zfs"><a aria-hidden="true" class="anchor-heading" href="#zfs"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>ZFS</h2>
<ul>
<li><a href="https://vadosware.io/post/everything-ive-seen-on-optimizing-postgres-on-zfs-on-linux/">Everything I've seen on optimizing Postgres on ZFS</a>: a collection of things to tweak when running Postgres on ZFS</li>
</ul></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#postgres" title="Postgres">Postgres</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#configuration" title="Configuration">Configuration</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#connection-pooling" title="Connection Pooling">Connection Pooling</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#gotchas" title="Gotchas">Gotchas</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#security" title="Security">Security</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#text-vs-varchar" title="Text Vs Varchar">Text Vs Varchar</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#zfs" title="ZFS">ZFS</a></div></div></div></div></div></div></div></div></div></main><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></section></section></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"57d0b6de-d1a2-4e2c-8548-83f54c96b0f3","title":"PostgreSQL","desc":"","updated":1640237319440,"created":1618141186045,"custom":{},"fname":"dev.PostgreSQL","type":"note","vault":{"name":"main","fsPath":"main","useFMTitle":false},"contentHash":"23f7db458070cc0238133bb66b94308f","links":[],"anchors":{"postgres":{"type":"header","text":"Postgres","value":"postgres","line":8,"column":0,"depth":1},"configuration":{"type":"header","text":"Configuration","value":"configuration","line":10,"column":0,"depth":2},"connection-pooling":{"type":"header","text":"Connection Pooling","value":"connection-pooling","line":15,"column":0,"depth":2},"gotchas":{"type":"header","text":"Gotchas","value":"gotchas","line":20,"column":0,"depth":2},"security":{"type":"header","text":"Security","value":"security","line":29,"column":0,"depth":2},"text-vs-varchar":{"type":"header","text":"Text Vs Varchar","value":"text-vs-varchar","line":33,"column":0,"depth":2},"zfs":{"type":"header","text":"ZFS","value":"zfs","line":37,"column":0,"depth":2}},"children":[],"parent":"8ec37b11-59ad-4ea8-82d9-3186e7e0cd29","data":{}},"body":"\u003ch1 id=\"postgres\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#postgres\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003ePostgres\u003c/h1\u003e\n\u003ch2 id=\"configuration\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#configuration\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eConfiguration\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://postgresqlco.nf/\"\u003ePostgresco.nf\u003c/a\u003e has recommendations for how to tune and configure various Postgres parameters, and documentation in a convenient readable format\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://pgtune.leopard.in.ua/\"\u003ePGTune\u003c/a\u003e generates configs for various scenarios that can be used as a starting point\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"connection-pooling\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#connection-pooling\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eConnection Pooling\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.pgbouncer.org/\"\u003ePgBouncer\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.pgpool.net/mediawiki/index.php/Main_Page\"\u003ePgpool\u003c/a\u003e, apparently more versatile than PgBouncer\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"gotchas\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#gotchas\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eGotchas\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://pgdash.io/blog/postgresql-six-not-so-easy-pieces.html\"\u003ePostgreSQL: Six Not-So-Easy Pieces\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://rbranson.medium.com/10-things-i-hate-about-postgresql-20dbab8c2791\"\u003e10 Things I Hate About PostgreSQL\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://blog.timescale.com/blog/how-we-made-distinct-queries-up-to-8000x-faster-on-postgresql/\"\u003eHow we made DISTINCT queries up to 8000x faster on PostgreSQL \u003c/a\u003e\n\u003cblockquote\u003e\n\u003cp\u003ePostgreSQL currently lacks the ability to efficiently pull a list of unique values from an ordered index. Even when you have an index that matches the exact order and columns for these \"last point\" queries, PostgreSQL is still forced to scan the entire index to find all unique values. As a table grows (and they grow quickly with time-series data), this operation keeps getting slower.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://news.ycombinator.com/item?id=28489340\"\u003eHN comment on the planner randomly switching to using a bad plan, slowing down queries significantly\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://about.gitlab.com/blog/2021/09/29/why-we-spent-the-last-month-eliminating-postgresql-subtransactions/\"\u003eProblems with subtransactions\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"security\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#security\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eSecurity\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://goteleport.com/blog/securing-postgres-postgresql/\"\u003ePostgreSQL Security Hardening\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"text-vs-varchar\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#text-vs-varchar\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eText Vs Varchar\u003c/h2\u003e\n\u003cp\u003eThe \u003ccode\u003etext\u003c/code\u003e data type has no limits on string length and seems like an easy choice over using \u003ccode\u003evarchar\u003c/code\u003e, as there are no performance advantages to using \u003ccode\u003evarchar\u003c/code\u003e over \u003ccode\u003etext\u003c/code\u003e. However, using \u003ccode\u003evarchar\u003c/code\u003e can help \u003ca href=\"https://brandur.org/text\"\u003eenforce constraints on reasonable text lengths\u003c/a\u003e and prevents storage of too much data.\u003c/p\u003e\n\u003ch2 id=\"zfs\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#zfs\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eZFS\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://vadosware.io/post/everything-ive-seen-on-optimizing-postgres-on-zfs-on-linux/\"\u003eEverything I've seen on optimizing Postgres on ZFS\u003c/a\u003e: a collection of things to tweak when running Postgres on ZFS\u003c/li\u003e\n\u003c/ul\u003e","noteIndex":{"id":"root","title":"root","desc":"","updated":1622102326440,"created":1595961348801,"stub":false,"custom":{"stub":false,"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"name":"main","fsPath":"main","useFMTitle":false},"contentHash":"2222728f026e86e75d06a6048c4f43ed","links":[],"anchors":{"personal-knowledge-base":{"type":"header","text":"Personal Knowledge Base","value":"personal-knowledge-base","line":9,"column":0,"depth":1}},"children":["9fa47ef8-a44b-4e36-929f-4aa7835b474d","6e43ea37-b3e7-44cf-aac7-31ae947d32a2","a10a1802-11d0-4557-a374-89712109cf90","0b9beaed-19ee-4124-a880-07e520da2b17","ddf3e9b2-ea12-4129-8785-06d6b82d4fcb","0oZbPtDwY3Yx79kLGIHCj","b4be93a8-69e3-4427-b4cd-53593c3ab387","5bbec2d1-4abe-4a2a-8bc5-5f3d4e229766","4a064a97-3d2d-4429-9a08-5b158dc7ef35","543e830d-feac-4048-8075-58c406bc1105","8875d2cf-85f8-41e8-b16d-c3707e40d74e","8ec37b11-59ad-4ea8-82d9-3186e7e0cd29","dOehc8Yap1zIbEqLvQvOt","b58269ed-9a0e-4213-b5b0-6d59c81d9899","b4fc6d48-17ae-4764-acdb-ec0f52707860","091b67bf-8bfa-454c-bbd3-7d84d8216229","f6fbee87-be27-471c-99bd-4af45d6a3156","fb9e4130-eaf8-425d-9039-5bc2ee876f18","4fb536a9-c146-4df3-8f30-9b2fb52a77f7","8M28iKQynnkvQ1JaMRMfU","MdMq6qcZqRL5FC79qG52K","21ef758d-ca84-4be0-8eed-5e95ab3b4a7e","5fb5baa9-8b3d-4044-9c03-bbabfbdfe78a","2f6af89e-df82-4144-87fc-a2be66a0e657","POgyWcSIqi29tpqfP5uyS","zU8YlwTOV1Du2mXeysgrk"],"parent":null,"data":{},"body":"\n# Personal Knowledge Base\n\nHi, and welcome to [Dickson Tan's](https://neurrone.com/pages/about/) personal knowledge base.\n\nThis is an experiment in note taking with the Zettelkasten method. This site is rendered with [Dendron](https://wiki.dendron.so/) which generates backlinks and an index, and provides other convenience features.\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":4,"useFMTitle":false,"useNoteTitleForLink":true,"mermaid":true,"useKatex":true,"dev":{"previewV2Enabled":false,"enablePreviewV2":true},"site":{"copyAssets":true,"siteHierarchies":["root"],"siteLastModified":true,"siteRootDir":"docs","siteUrl":"https://kb.neurrone.com","usePrettyRefs":true,"title":"Personal Knowledge Base","description":"Personal knowledge Base","author":"Dickson Tan","twitter":"neurrone","duplicateNoteBehavior":{"action":"useVault","payload":["main","health","Human Dynamics"]},"gh_edit_branch":"main","usePrettyLinks":true,"siteNotesDir":"notes","siteFaviconPath":"favicon.ico","gh_edit_link":true,"gh_edit_link_text":"Edit this page on GitHub","gh_root":"docs/","gh_edit_view_mode":"edit","writeStubs":true,"siteIndex":"root"},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":false,"leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"randomNote":{}},"workspace":{"dendronVersion":"0.73.1","vaults":[{"fsPath":"human-dynamics","name":"Human Dynamics","useFMTitle":false},{"name":"govtech","fsPath":"govtech","visibility":"private","useFMTitle":false},{"name":"health","fsPath":"health","useFMTitle":false},{"name":"main","fsPath":"main","useFMTitle":false},{"name":"personal","fsPath":"personal","visibility":"private"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"graph":{"zoomSpeed":1},"disableTelemetry":true,"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"maxPreviewsCached":10,"maxNoteLength":204800,"enableUserTags":true,"enableHashTags":true,"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link"},"enableEditorDecorations":true},"preview":{"enableFMTitle":false,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"57d0b6de-d1a2-4e2c-8548-83f54c96b0f3"},"buildId":"17b8tlY5vwWfS-FGW7Cgx","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>