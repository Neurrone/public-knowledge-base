<h1 id="kopia">Kopia<a aria-hidden="true" class="anchor-heading icon-link" href="#kopia"></a></h1>
<h2 id="repositories">Repositories<a aria-hidden="true" class="anchor-heading icon-link" href="#repositories"></a></h2>
<p>Like Git, backups live in repositories</p>
<h3 id="create-repository">Create Repository<a aria-hidden="true" class="anchor-heading icon-link" href="#create-repository"></a></h3>
<p>General form: <code>kopia repository create &#x3C;provider> &#x3C;flags></code></p>
<pre class="language-sh"><code class="language-sh"># on local filesystem
kopia repository create filesystem --path d:/temp/kopia

# to an SFTP destination
kopia repository connect sftp \
        --path=backups \
        --host=sftp.neurrone.com \
        --username Backup \
        --keyfile=backup_ecdsa \
        --override-hostname=T480
</code></pre>
<p>This also connects Kopia to the repository that was just created.</p>
<h3 id="connecting-to-an-existing-repository">Connecting to an existing repository<a aria-hidden="true" class="anchor-heading icon-link" href="#connecting-to-an-existing-repository"></a></h3>
<p>Use the same flags as create but instead of create use connect:</p>
<pre class="language-sh"><code class="language-sh">kopia repository connect filesystem --path d:/temp/kopia
</code></pre>
<h3 id="disconnecting-from-a-repository">Disconnecting from a repository<a aria-hidden="true" class="anchor-heading icon-link" href="#disconnecting-from-a-repository"></a></h3>
<pre class="language-sh"><code class="language-sh">kopia repository disconnect
</code></pre>
<h2 id="snapshots">Snapshots<a aria-hidden="true" class="anchor-heading icon-link" href="#snapshots"></a></h2>
<h3 id="creating-snapshots">Creating Snapshots<a aria-hidden="true" class="anchor-heading icon-link" href="#creating-snapshots"></a></h3>
<pre class="language-sh"><code class="language-sh"># multiple paths are accepted
kopia snapshot create D:\temp\folder1 D:\temp\folder2
</code></pre>
<p>You can create snapshots for different folders, they will be individually tracked.</p>
<h3 id="mounting">Mounting<a aria-hidden="true" class="anchor-heading icon-link" href="#mounting"></a></h3>
<p>Allows convenient browsing of snapshot contents and is the recommended way to do a restore.</p>
<pre class="language-sh"><code class="language-sh"># mounts the latest version of the repository when using the special path "all"
# otherwise, pass in the snapshot id to mount
kopia mount all /tmp/mnt
</code></pre>
<p>On Windows, a WebDav server is used for the mounting, replace the last argument with a free drive letter like <code>Z:</code></p>
<h3 id="restoring-snapshots">Restoring snapshots<a aria-hidden="true" class="anchor-heading icon-link" href="#restoring-snapshots"></a></h3>
<p>To restore the snapshot <code>kf4b323108ef0e38362ad9d482548502e</code> to <code>d:/docs</code>:</p>
<pre class="language-sh"><code class="language-sh">kopia restore kf4b323108ef0e38362ad9d482548502e d:/docs
</code></pre>
<h2 id="diffing-snapshots">Diffing Snapshots<a aria-hidden="true" class="anchor-heading icon-link" href="#diffing-snapshots"></a></h2>
<pre class="language-sh"><code class="language-sh"># use the root ids of the snapshots to get the ids
kopia diff &#x3C;snapshot1> &#x3C;snapshot2>
</code></pre>
<h2 id="policies">Policies<a aria-hidden="true" class="anchor-heading icon-link" href="#policies"></a></h2>
<pre class="language-sh"><code class="language-sh">kopia policy show --global

# ignoring files
# On Synology NAS, you probably want to ignore these files
kopia policy set --global --add-dot-ignore @eaDir
kopia policy set --global --add-dot-ignore "#recycle"

# set compression globally
kopia policy set --global --compression=s2-default
</code></pre>
<h2 id="connect-to-repository-with-different-user-credentials">Connect To Repository With Different User Credentials<a aria-hidden="true" class="anchor-heading icon-link" href="#connect-to-repository-with-different-user-credentials"></a></h2>
<pre class="language-sh"><code class="language-sh">kopia repository connect --config-file /path/to/repository.config &#x3C;usual connect params>
kopia --config-file /path/to/repository.config maintenance run
</code></pre>
<h2 id="setting-cache-directory">Setting cache directory<a aria-hidden="true" class="anchor-heading icon-link" href="#setting-cache-directory"></a></h2>
<pre class="language-sh"><code class="language-sh">kopia cache set --cache-directory=...
</code></pre>
<h2 id="official-documentation">Official Documentation<a aria-hidden="true" class="anchor-heading icon-link" href="#official-documentation"></a></h2>
<ul>
<li><a href="https://kopia.io/docs/getting-started/">Getting started</a></li>
<li><a href="https://kopia.io/docs/reference/command-line/">Command line</a></li>
</ul>