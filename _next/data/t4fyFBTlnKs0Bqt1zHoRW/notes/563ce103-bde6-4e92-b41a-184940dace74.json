{"pageProps":{"note":{"id":"563ce103-bde6-4e92-b41a-184940dace74","title":"Using Serverless Framework With Aws","vault":{"name":"main","fsPath":"main","useFMTitle":false},"type":"note","desc":"Gotchas when using the serverless framework with AWS","links":[{"type":"wiki","from":{"fname":"tools.serverless.aws","id":"563ce103-bde6-4e92-b41a-184940dace74","vaultName":"main"},"value":"tools.aws.sqs","alias":"necessary permissions to encrypt / decrypt the messages","position":{"start":{"line":38,"column":64,"offset":1859},"end":{"line":38,"column":137,"offset":1932},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"tools.aws.sqs"}}],"anchors":{"api-gateway":{"type":"header","text":"Api-gateway","value":"api-gateway","line":8,"column":0},"errors-during-sls-deploy":{"type":"header","text":"Errors During sls deploy","value":"errors-during-sls-deploy","line":14,"column":0},"check-lambda-permissions":{"type":"header","text":"Check Lambda Permissions","value":"check-lambda-permissions","line":20,"column":0},"troubleshooting-sqs-invocations":{"type":"header","text":"Troubleshooting SQS Invocations","value":"troubleshooting-sqs-invocations","line":32,"column":0}},"fname":"tools.serverless.aws","updated":1635737736937,"created":1617456663738,"parent":"93e0f902-47d4-4cc7-9027-5de0012f6c57","children":[],"data":{},"contentHash":"1de00572bc3cdd94580a5765fba04a3d","custom":{}},"body":"<h2 id=\"api-gateway\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#api-gateway\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Api-gateway</h2>\n<p>As at time of writing (Apr 2021), configuring api-gateway with api keys and usage plans is bugged according to the official docs. The docs say to <a href=\"https://www.serverless.com/framework/docs/deprecations#api-gateway-specific-configuration\">put configuration in provider.apigateway, instead of under provider directly</a>.</p>\n<p>However, this does not work, and you must place them under provider (the deprecated behaviour) instead.</p>\n<h2 id=\"errors-during-sls-deploy\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#errors-during-sls-deploy\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Errors During sls deploy</h2>\n<p>Sometimes, deploying the cloud formation stack fails with errors such as \"stack not found\".</p>\n<p>The error messages are horrible; errors in the serverless.yml file could cause it. This is probably caused by the error causing the stack creation to fail, resulting in subsequent commands not being able to use it.</p>\n<h2 id=\"check-lambda-permissions\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#check-lambda-permissions\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Check Lambda Permissions</h2>\n<pre class=\"language-sh\"><code class=\"language-sh\">aws iam get-role-policy --role-name &#x3C;function role> --policy-name &#x3C;policy name>\n\n# to get the function role\naws lambda get-function --function-name &#x3C;function>\n\n# to get policy name\naws iam list-role-policies --role-name &#x3C;role>\n</code></pre>\n<h2 id=\"troubleshooting-sqs-invocations\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#troubleshooting-sqs-invocations\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Troubleshooting SQS Invocations</h2>\n<p>When configuring a lambda function to run on receipt of an SQS message, I ran into the following problems, these are useful things to check to troubleshoot the problem.</p>\n<ul>\n<li>Check if the event source mapping got disabled. I had this happen to me even though at the code level it was enabled, so I am not sure why.\n<pre class=\"language-sh\"><code class=\"language-sh\">aws lambda list-event-source-mappings --function-name &#x3C;function-name>\n# if the state shows as being disabled, re-enable it:\naws lambda   update-event-source-mapping --uuid &#x3C;uuid from previous command> --enabled\n</code></pre>\n</li>\n<li>Check if the queue has the expected attributes set, especially if using encryption: <code>aws sqs get-queue-attributes --queue-url &#x3C;url> --attribute-names All</code></li>\n<li>If the queue uses encryption, ensure that the lambda has the <a href=\"/notes/slIGj2pqttjbdwc0QlUaQ\">necessary permissions to encrypt / decrypt the messages</a>. Otherwise, messages get dropped silently.</li>\n</ul>","noteIndex":{"id":"root","title":"root","vault":{"name":"main","fsPath":"main","useFMTitle":false},"type":"note","desc":"","links":[],"anchors":{"personal-knowledge-base":{"type":"header","text":"Personal Knowledge Base","value":"personal-knowledge-base","line":9,"column":0}},"fname":"root","updated":1622102326440,"created":1595961348801,"parent":null,"children":["9fa47ef8-a44b-4e36-929f-4aa7835b474d","6e43ea37-b3e7-44cf-aac7-31ae947d32a2","a10a1802-11d0-4557-a374-89712109cf90","0b9beaed-19ee-4124-a880-07e520da2b17","ddf3e9b2-ea12-4129-8785-06d6b82d4fcb","65swI4wiTjaw7fQsGQqKC","b4be93a8-69e3-4427-b4cd-53593c3ab387","5bbec2d1-4abe-4a2a-8bc5-5f3d4e229766","4a064a97-3d2d-4429-9a08-5b158dc7ef35","543e830d-feac-4048-8075-58c406bc1105","8875d2cf-85f8-41e8-b16d-c3707e40d74e","8ec37b11-59ad-4ea8-82d9-3186e7e0cd29","dOehc8Yap1zIbEqLvQvOt","b58269ed-9a0e-4213-b5b0-6d59c81d9899","b4fc6d48-17ae-4764-acdb-ec0f52707860","091b67bf-8bfa-454c-bbd3-7d84d8216229","f6fbee87-be27-471c-99bd-4af45d6a3156","fb9e4130-eaf8-425d-9039-5bc2ee876f18","4fb536a9-c146-4df3-8f30-9b2fb52a77f7","21ef758d-ca84-4be0-8eed-5e95ab3b4a7e","5fb5baa9-8b3d-4044-9c03-bbabfbdfe78a","2f6af89e-df82-4144-87fc-a2be66a0e657","POgyWcSIqi29tpqfP5uyS","gejtw6zG3oA4WfIXlYR0H"],"data":{},"contentHash":"2222728f026e86e75d06a6048c4f43ed","custom":{"stub":false,"nav_order":0,"permalink":"/"},"body":"\n# Personal Knowledge Base\n\nHi, and welcome to [Dickson Tan's](https://neurrone.com/pages/about/) personal knowledge base.\n\nThis is an experiment in note taking with the Zettelkasten method. This site is rendered with [Dendron](https://wiki.dendron.so/) which generates backlinks and an index, and provides other convenience features.\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":3,"useFMTitle":false,"useNoteTitleForLink":true,"noLegacyNoteRef":true,"mermaid":true,"useKatex":true,"usePrettyRefs":true,"dev":{"previewV2Enabled":false,"enablePreviewV2":true},"site":{"copyAssets":true,"siteHierarchies":["root"],"siteLastModified":true,"siteRootDir":"docs","siteUrl":"https://kb.neurrone.com","usePrettyRefs":true,"title":"Personal Knowledge Base","description":"Personal knowledge Base","author":"Dickson Tan","twitter":"neurrone","duplicateNoteBehavior":{"action":"useVault","payload":["main","health","Human Dynamics"]},"gh_edit_branch":"main","usePrettyLinks":true,"siteNotesDir":"notes","siteFaviconPath":"favicon.ico","gh_edit_link":true,"gh_edit_link_text":"Edit this page on GitHub","gh_root":"docs/","gh_edit_view_mode":"edit","writeStubs":true,"siteIndex":"root"},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":false,"leaveTrace":false,"bubbleUpCreateNew":true}},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"randomNote":{}},"workspace":{"dendronVersion":"0.64.1","vaults":[{"fsPath":"human-dynamics","name":"Human Dynamics","useFMTitle":false},{"name":"govtech","fsPath":"govtech","visibility":"private","useFMTitle":false},{"name":"health","fsPath":"health","useFMTitle":false},{"name":"main","fsPath":"main","useFMTitle":false},{"name":"personal","fsPath":"personal","visibility":"private"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"graph":{"zoomSpeed":1},"disableTelemetry":true,"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"maxPreviewsCached":10,"maxNoteLength":204800,"enableUserTags":true,"enableHashTags":true,"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link"}},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true}}},"__N_SSG":true}